/* Events: Sample, Zero Crossings, Relations, Discrete Changes */
/* Simulation code for CyPhy.TestBenches.DC_Spacecraft_333 generated by the OpenModelica Compiler 1.9.2 Beta1 (r24371). */

#include "openmodelica.h"
#include "openmodelica_func.h"
#include "simulation_data.h"
#include "simulation/simulation_info_xml.h"
#include "simulation/simulation_runtime.h"
#include "util/omc_error.h"
#include "simulation/solver/model_help.h"
#include "simulation/solver/delay.h"
#include "simulation/solver/linearSystem.h"
#include "simulation/solver/nonlinearSystem.h"
#include "simulation/solver/mixedSystem.h"

#include <assert.h>
#include <string.h>

#include "DC_Spacecraft_333_functions.h"
#include "DC_Spacecraft_333_model.h"
#include "DC_Spacecraft_333_literals.h"




#if defined(HPCOM) && !defined(_OPENMP)
  #error "HPCOM requires OpenMP or the results are wrong"
#endif
#if defined(_OPENMP)
  #include <omp.h>
#else
  /* dummy omp defines */
  #define omp_get_max_threads() 1
#endif

#define threadData data->threadData

#if defined(__cplusplus)
extern "C" {
#endif

/* Initializes the raw time events of the simulation using the now
   calcualted parameters. */
void DC_Spacecraft_333_function_initSample(DATA *data)
{
  long i=0;
}

const char *DC_Spacecraft_333_zeroCrossingDescription(int i, int **out_EquationIndexes)
{
  static const char *res[] = {"time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime or DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.nperiod == 0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 50.0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 550.0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 610.0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime",
  "DC_Spacecraft_cfg1.Computers.PID.addSat.u2 > DC_Spacecraft_cfg1.Computers.PID.limiter.uMax",
  "DC_Spacecraft_cfg1.Computers.PID.addSat.u2 < DC_Spacecraft_cfg1.Computers.PID.limiter.uMin",
  "integer((time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period) > pre(DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.count)",
  "integer((time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period, 0)"};
  static const int occurEqs0[] = {1,153};
  static const int occurEqs1[] = {1,153};
  static const int occurEqs2[] = {1,153};
  static const int occurEqs3[] = {1,153};
  static const int occurEqs4[] = {1,157};
  static const int occurEqs5[] = {1,178};
  static const int occurEqs6[] = {1,178};
  static const int occurEqs7[] = {1,150};
  static const int occurEqs8[] = {1,150};
  static const int *occurEqs[] = {occurEqs0,occurEqs1,occurEqs2,occurEqs3,occurEqs4,occurEqs5,occurEqs6,occurEqs7,occurEqs8};
  *out_EquationIndexes = (int*) occurEqs[i];
  return res[i];
}

int DC_Spacecraft_333_function_ZeroCrossingsEquations(DATA *data)
{
  TRACE_PUSH
  
  data->simulationInfo.callStatistics.functionZeroCrossingsEquations++;
  
  data->simulationInfo.discreteCall = 0;
  DC_Spacecraft_333_eqFunction_150(data);

  DC_Spacecraft_333_eqFunction_157(data);

  DC_Spacecraft_333_eqFunction_158(data);

  DC_Spacecraft_333_eqFunction_159(data);

  DC_Spacecraft_333_eqFunction_161(data);

  DC_Spacecraft_333_eqFunction_162(data);

  DC_Spacecraft_333_eqFunction_163(data);

  DC_Spacecraft_333_eqFunction_164(data);

  DC_Spacecraft_333_eqFunction_165(data);

  DC_Spacecraft_333_eqFunction_166(data);

  DC_Spacecraft_333_eqFunction_169(data);

  DC_Spacecraft_333_eqFunction_170(data);

  DC_Spacecraft_333_eqFunction_171(data);

  DC_Spacecraft_333_eqFunction_172(data);

  DC_Spacecraft_333_eqFunction_173(data);

  DC_Spacecraft_333_eqFunction_174(data);

  DC_Spacecraft_333_eqFunction_175(data);

  DC_Spacecraft_333_eqFunction_228(data);
  
  TRACE_POP
  return 0;
}

int DC_Spacecraft_333_function_ZeroCrossings(DATA *data, double *gout)
{
  TRACE_PUSH
  modelica_boolean tmp1142;
  modelica_boolean tmp1144;
  modelica_boolean tmp1145;
  modelica_boolean tmp1146;
  modelica_boolean tmp1147;
  modelica_boolean tmp1148;
  modelica_boolean tmp1149;
  modelica_real tmp1150;
  modelica_boolean tmp1151;
  modelica_real tmp1152;
  
  data->simulationInfo.callStatistics.functionZeroCrossings++;
  
  tmp1142 = LessZC(time, $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime, data->simulationInfo.storedRelations[0]);
  gout[0] = ((tmp1142 || ((modelica_integer)$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pnperiod == (modelica_integer) 0))) ? 1 : -1;
  tmp1144 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 50.0), data->simulationInfo.storedRelations[1]);
  gout[1] = (tmp1144) ? 1 : -1;
  tmp1145 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 550.0), data->simulationInfo.storedRelations[2]);
  gout[2] = (tmp1145) ? 1 : -1;
  tmp1146 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 610.0), data->simulationInfo.storedRelations[3]);
  gout[3] = (tmp1146) ? 1 : -1;
  tmp1147 = LessZC(time, $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime, data->simulationInfo.storedRelations[0]);
  gout[4] = (tmp1147) ? 1 : -1;
  tmp1148 = GreaterZC($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2, $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMax, data->simulationInfo.storedRelations[4]);
  gout[5] = (tmp1148) ? 1 : -1;
  tmp1149 = LessZC($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2, $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMin, data->simulationInfo.storedRelations[5]);
  gout[6] = (tmp1149) ? 1 : -1;
  tmp1150 = $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod;
  if (tmp1150 == 0) {throwStreamPrint(threadData, "Division by zero %s", "(time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period");}
  tmp1151 = Greater(((modelica_integer)floor(((time - $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime) / $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod))),$P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount);
  gout[7] = (tmp1151) ? 1 : -1;
  tmp1152 = $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod;
  if (tmp1152 == 0) {throwStreamPrint(threadData, "Division by zero %s", "(time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period");}
  gout[8] = (floor(((time - $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime) / $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod)) != floor(data->simulationInfo.mathEventsValuePre[(modelica_integer) 0])) ? 1 : -1;
  
  TRACE_POP
  return 0;
}

const char *DC_Spacecraft_333_relationDescription(int i)
{
  const char *res[] = {"time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 50.0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 550.0",
  "time < DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.T_start + 610.0",
  "DC_Spacecraft_cfg1.Computers.PID.addSat.u2 > DC_Spacecraft_cfg1.Computers.PID.limiter.uMax",
  "DC_Spacecraft_cfg1.Computers.PID.addSat.u2 < DC_Spacecraft_cfg1.Computers.PID.limiter.uMin",
  "integer((time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period) > pre(DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.count)"};
  return res[i];
}

int DC_Spacecraft_333_function_updateRelations(DATA *data, int evalforZeroCross)
{
  TRACE_PUSH
  modelica_boolean tmp1153;
  modelica_boolean tmp1154;
  modelica_boolean tmp1155;
  modelica_boolean tmp1156;
  modelica_boolean tmp1157;
  modelica_boolean tmp1158;
  modelica_real tmp1159;
  modelica_boolean tmp1160;
  modelica_real tmp1161;
  
  
  if(evalforZeroCross)
  {
    tmp1153 = LessZC(time, $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime, data->simulationInfo.storedRelations[0]);
    data->simulationInfo.relations[0] = tmp1153;
    tmp1154 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 50.0), data->simulationInfo.storedRelations[1]);
    data->simulationInfo.relations[1] = tmp1154;
    tmp1155 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 550.0), data->simulationInfo.storedRelations[2]);
    data->simulationInfo.relations[2] = tmp1155;
    tmp1156 = LessZC(time, ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 610.0), data->simulationInfo.storedRelations[3]);
    data->simulationInfo.relations[3] = tmp1156;
    tmp1157 = GreaterZC($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2, $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMax, data->simulationInfo.storedRelations[4]);
    data->simulationInfo.relations[4] = tmp1157;
    tmp1158 = LessZC($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2, $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMin, data->simulationInfo.storedRelations[5]);
    data->simulationInfo.relations[5] = tmp1158;
    tmp1159 = $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod;
    if (tmp1159 == 0) {throwStreamPrint(threadData, "Division by zero %s", "(time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period");}
    tmp1160 = Greater(((modelica_integer)floor(((time - $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime) / $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod))),$P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount);
    data->simulationInfo.relations[6] = tmp1160;
  }
  else
  {
    data->simulationInfo.relations[0] = (time < $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime);
    data->simulationInfo.relations[1] = (time < ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 50.0));
    data->simulationInfo.relations[2] = (time < ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 550.0));
    data->simulationInfo.relations[3] = (time < ($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start + 610.0));
    data->simulationInfo.relations[4] = ($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2 > $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMax);
    data->simulationInfo.relations[5] = ($PDC_Spacecraft_cfg1$PComputers$PPID$PaddSat$Pu2 < $PDC_Spacecraft_cfg1$PComputers$PPID$Plimiter$PuMin);
    tmp1161 = $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod;
    if (tmp1161 == 0) {throwStreamPrint(threadData, "Division by zero %s", "(time - DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.startTime) / DC_Spacecraft_cfg1.attitudeScenario.trapezoid1.period");}
    data->simulationInfo.relations[6] = (((modelica_integer)floor(((time - $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PstartTime) / $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pperiod))) > $P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount);
  }
  
  TRACE_POP
  return 0;
}

int DC_Spacecraft_333_checkForDiscreteChanges(DATA *data)
{
  TRACE_PUSH
  int needToIterate = 0;

  infoStreamPrint(LOG_EVENTS_V, 1, "check for discrete changes at time=%.12g", data->localData[0]->timeValue);
  if($P$whenCondition1 != $P$PRE$P$whenCondition1)
  {
    infoStreamPrint(LOG_EVENTS_V, 0, "discrete var changed: $whenCondition1 from %d to %d", $P$PRE$P$whenCondition1, $P$whenCondition1);
    needToIterate = 1;
  }
  if($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start != $P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start)
  {
    infoStreamPrint(LOG_EVENTS_V, 0, "discrete var changed: DC_Spacecraft_cfg1._attitudeScenario._trapezoid1._T_start from %g to %g", $P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start, $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$PT_start);
    needToIterate = 1;
  }
  if($PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount != $P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount)
  {
    infoStreamPrint(LOG_EVENTS_V, 0, "discrete var changed: DC_Spacecraft_cfg1._attitudeScenario._trapezoid1._count from %ld to %ld", $P$PRE$PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount, $PDC_Spacecraft_cfg1$PattitudeScenario$Ptrapezoid1$Pcount);
    needToIterate = 1;
  }
  if (ACTIVE_STREAM(LOG_EVENTS_V)) messageClose(LOG_EVENTS_V);
  
  TRACE_POP
  return needToIterate;
}

#if defined(__cplusplus)
}
#endif

